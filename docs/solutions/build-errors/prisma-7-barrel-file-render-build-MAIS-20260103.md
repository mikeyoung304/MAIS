---
title: 'Prisma 7 Build Failure - Barrel File Required for Render Deployment'
slug: prisma-7-barrel-file-render-build
date: 2026-01-03
category: build-errors
severity: P0
tags: [prisma, render, deployment, breaking-change, typescript]
symptoms:
  - "Cannot find module './generated/prisma'"
  - Build works locally but fails on Render
  - TypeScript errors after Prisma 7 upgrade
related:
  - prisma-7-json-type-breaking-changes-MAIS-20260102.md
---

# Prisma 7 Build Failure - Barrel File Required for Render Deployment

## Problem

After upgrading to Prisma 7, builds fail on Render with:

```
error TS2307: Cannot find module './generated/prisma' or its corresponding type declarations.
```

**Key symptom:** Works locally (cached `index.ts` exists), fails on fresh builds (Render, CI).

## Root Cause

Prisma 7 changed the generated entry point:

| Prisma Version | Entry Point |
| -------------- | ----------- |
| Prisma 6       | `index.ts`  |
| Prisma 7       | `client.ts` |

Existing imports expect `index.ts`:

```typescript
// This import looks for index.ts
import { PrismaClient } from '../generated/prisma';
```

## Solution

### 1. Create Post-Generate Script

**File:** `server/scripts/prisma-postgenerate.js`

```javascript
#!/usr/bin/env node
import { writeFileSync } from 'fs';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';

const __dirname = dirname(fileURLToPath(import.meta.url));
const generatedDir = join(__dirname, '../src/generated/prisma');
const indexPath = join(generatedDir, 'index.ts');

const barrelContent = `/**
 * Prisma 7 Barrel File - Backward Compatibility Layer
 * AUTO-GENERATED by scripts/prisma-postgenerate.js
 */
export * from './client';
`;

try {
  writeFileSync(indexPath, barrelContent, 'utf-8');
  console.log('✅ Created Prisma barrel file: src/generated/prisma/index.ts');
} catch (error) {
  console.error('❌ Failed to create Prisma barrel file:', error);
  process.exit(1);
}
```

### 2. Update package.json

```json
{
  "scripts": {
    "prisma:generate": "prisma generate && node scripts/prisma-postgenerate.js",
    "build": "npm run prisma:generate && tsc -b"
  }
}
```

### 3. Update render.yaml

```yaml
buildCommand: npm ci && npm run build --workspace=@macon/contracts && npm run build --workspace=@macon/shared && npm run build --workspace=@macon/api
envVars:
  - key: DATABASE_URL
    sync: false
  - key: DIRECT_URL
    sync: false
```

The `npm run build` now includes `prisma:generate` which runs both `prisma generate` AND the postgenerate script.

**CRITICAL:** Both `DATABASE_URL` and `DIRECT_URL` environment variables must be set on Render:

- `DATABASE_URL` = Session Pooler connection (for runtime queries)
- `DIRECT_URL` = Transaction Pooler connection (for `prisma generate` schema introspection)

Without `DIRECT_URL`, Prisma 7 fails with: `PrismaConfigEnvError: Cannot resolve environment variable: DIRECT_URL`

## Why This Works

```
npm run build
  → npm run prisma:generate
    → prisma generate (creates client.ts)
    → node scripts/prisma-postgenerate.js (creates index.ts barrel)
  → tsc -b (finds index.ts, compilation succeeds)
```

## Prevention Checklist

- [ ] Always check Prisma release notes before major upgrades
- [ ] Test builds in clean environment (not just local with cache)
- [ ] Use postgenerate scripts for backward compatibility
- [ ] Include generated directory in `.gitignore` (forces fresh generation)

## Related Documentation

- [Prisma 7 JSON Type Breaking Changes](./prisma-7-json-type-breaking-changes-MAIS-20260102.md)
- [Prisma Upgrade Checklist](../database-issues/prisma-upgrade-checklist-MAIS-20260102.md)
