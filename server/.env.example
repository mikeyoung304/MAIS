# ============================================================================
# ENVIRONMENT CONFIGURATION TEMPLATE
# ============================================================================
# Copy this file to .env and fill in your actual values
# NEVER commit .env to version control - it contains sensitive secrets!
# ============================================================================

# ----------------------------------------------------------------------------
# APPLICATION MODE
# ----------------------------------------------------------------------------
# Adapter mode: "mock" for development, "real" for production
ADAPTERS_PRESET=mock

# ----------------------------------------------------------------------------
# SERVER CONFIGURATION
# ----------------------------------------------------------------------------
API_PORT=3001
CORS_ORIGIN=http://localhost:3000

# Graceful shutdown timeout in milliseconds (default: 60000)
# Increase this if you have long-running requests or slow database connections
# Example: 120000 for 2 minutes, 300000 for 5 minutes
GRACEFUL_SHUTDOWN_TIMEOUT_MS=60000

# ----------------------------------------------------------------------------
# SECURITY - JWT AUTHENTICATION
# ----------------------------------------------------------------------------
# JWT signing secret - CRITICAL: Must be cryptographically secure
# Generate using: openssl rand -hex 32
# NEVER reuse across environments (dev/staging/prod)
JWT_SECRET=your-64-character-hex-string-here

# Booking token secret - REQUIRED: Must be separate from JWT_SECRET
# This prevents privilege escalation if tenant admin JWT is compromised
# Generate using: openssl rand -hex 32
BOOKING_TOKEN_SECRET=your-64-character-hex-string-here

# ----------------------------------------------------------------------------
# DATABASE CONFIGURATION
# ----------------------------------------------------------------------------
# PostgreSQL connection string
# Format: postgresql://USERNAME:PASSWORD@HOST:PORT/DATABASE?sslmode=require
#
# For Supabase:
# - Get connection string from: Project Settings > Database > Connection String
# - Use Transaction Mode pooler (port 5432) for Prisma migrations
# - URL-encode special characters in password (@ becomes %40)
DATABASE_URL=postgresql://user:password@host:5432/database?sslmode=require
DIRECT_URL=postgresql://user:password@host:5432/database?sslmode=require

# ----------------------------------------------------------------------------
# SUPABASE CONFIGURATION (if using Supabase)
# ----------------------------------------------------------------------------
# Get these from: Project Settings > API
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_ANON_KEY=your-anon-key-here
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here

# ----------------------------------------------------------------------------
# MULTI-TENANT ENCRYPTION
# ----------------------------------------------------------------------------
# Encryption key for tenant-specific secrets (Stripe keys, API keys, etc.)
# Generate using: openssl rand -hex 32
# CRITICAL: Backup this key securely - losing it means losing tenant secrets!
TENANT_SECRETS_ENCRYPTION_KEY=your-64-character-hex-string-here

# ----------------------------------------------------------------------------
# STRIPE CONFIGURATION
# ----------------------------------------------------------------------------
# Get your test keys from: https://dashboard.stripe.com/test/apikeys
# For production, use live keys: https://dashboard.stripe.com/apikeys
#
# IMPORTANT: In production, tenant-specific Stripe keys should be stored
# in the database (encrypted with TENANT_SECRETS_ENCRYPTION_KEY)

# Server-side API key (REQUIRED - keep secret!)
# Test: sk_test_... | Live: sk_live_...
STRIPE_SECRET_KEY=sk_test_YOUR_STRIPE_SECRET_KEY_HERE

# Webhook signing secret (REQUIRED for security)
# Development: Run `stripe listen --forward-to localhost:3001/api/webhooks/stripe`
# Production: Get from https://dashboard.stripe.com/webhooks
STRIPE_WEBHOOK_SECRET=whsec_YOUR_WEBHOOK_SECRET_HERE

# Stripe Connect webhook secret (REQUIRED for Connect account events)
# Development: Run `stripe listen --forward-to localhost:3001/v1/webhooks/stripe/connect`
# Production: Create separate webhook endpoint in Stripe Dashboard for Connect events
# Subscribe to: account.updated, account.application.deauthorized
STRIPE_CONNECT_WEBHOOK_SECRET=whsec_YOUR_CONNECT_WEBHOOK_SECRET_HERE

# Checkout redirect URLs
# Customer is sent here after successful payment
STRIPE_SUCCESS_URL=http://localhost:3000/success
# Customer is sent here if they cancel payment
STRIPE_CANCEL_URL=http://localhost:3000

# Subscription Tier Price IDs
# Create products in Stripe Dashboard:
# 1. "Handled Starter" - $49/month recurring
# 2. "Handled Growth" - $150/month recurring
# Copy the price IDs (price_xxx) below
STRIPE_STARTER_PRICE_ID=price_YOUR_STARTER_PRICE_ID
STRIPE_PRO_PRICE_ID=price_YOUR_PRO_PRICE_ID

# ----------------------------------------------------------------------------
# EMAIL CONFIGURATION (Optional)
# ----------------------------------------------------------------------------
# Postmark email service (optional in real mode; file-sink used in tmp/emails/ if empty)
POSTMARK_SERVER_TOKEN=
POSTMARK_FROM_EMAIL=bookings@example.com

# Early access notification recipient (platform owner)
# Receives notifications when users request early access
# Defaults to mike@maconheadshots.com if not set
EARLY_ACCESS_NOTIFICATION_EMAIL=mike@maconheadshots.com

# Admin notification email for tenant signups
# Receives notifications when new tenants register
# Defaults to mike@maconheadshots.com if not set
ADMIN_NOTIFICATION_EMAIL=mike@maconheadshots.com

# ----------------------------------------------------------------------------
# CALENDAR INTEGRATION (Optional)
# ----------------------------------------------------------------------------
# Google Calendar (optional in real mode; mock calendar used if empty)
# Share your calendar with the service account email before using
# To get service account: https://console.cloud.google.com/iam-admin/serviceaccounts
GOOGLE_CALENDAR_ID=
GOOGLE_SERVICE_ACCOUNT_JSON_BASE64=

# ----------------------------------------------------------------------------
# SCHEDULED TASKS
# ----------------------------------------------------------------------------
# Reminder scheduler cron expression (optional - uses default if not set)
# Format: minute hour day month weekday
# Default: '0 9 * * *' (daily at 9:00 AM)
# Examples:
#   '0 9 * * *'    = Daily at 9:00 AM
#   '0 */6 * * *'  = Every 6 hours
#   '0 8,20 * * *' = Daily at 8 AM and 8 PM
REMINDER_CRON_SCHEDULE=0 9 * * *

# ----------------------------------------------------------------------------
# REDIS CONFIGURATION (Optional - for async webhook processing)
# ----------------------------------------------------------------------------
# Redis URL for BullMQ job queue
# If not configured, webhooks are processed synchronously (fallback mode)
# For local development: redis://localhost:6379
# For production: Use Redis Cloud, AWS ElastiCache, or similar
REDIS_URL=redis://localhost:6379

# ----------------------------------------------------------------------------
# NEXT.JS ISR REVALIDATION
# ----------------------------------------------------------------------------
# For triggering frontend cache refresh when backend data changes
# This should point to your Next.js app URL
NEXTJS_APP_URL=http://localhost:3000

# Revalidation secret - must match NEXTJS_REVALIDATE_SECRET in apps/web/.env
# Generate using: openssl rand -hex 32
NEXTJS_REVALIDATE_SECRET=

# ----------------------------------------------------------------------------
# INTERNAL API SECRET
# ----------------------------------------------------------------------------
# For secure service-to-service communication
# Generate using: openssl rand -hex 32
INTERNAL_API_SECRET=

# ----------------------------------------------------------------------------
# ADMIN USER (Development Only)
# ----------------------------------------------------------------------------
# Platform admin credentials for seeding (required for db:seed:production and db:seed:dev)
# In production, create admin users through secure onboarding process
ADMIN_EMAIL=admin@example.com
ADMIN_NAME=Platform Admin
# Default admin password - CHANGE THIS IN PRODUCTION!
# Minimum 12 characters required
ADMIN_DEFAULT_PASSWORD=ChangeThisToAStrongPassword123!

# Anthropic API Key for AI Agent (optional - required for agent chat feature)
ANTHROPIC_API_KEY=

# ----------------------------------------------------------------------------
# OBSERVABILITY / METRICS
# ----------------------------------------------------------------------------
# Bearer token for metrics endpoints authentication
# REQUIRED in production - metrics disabled without this
# Generate using: openssl rand -hex 32
#
# Configure Prometheus scrape config:
#   - job_name: 'handled-api'
#     bearer_token: 'your-token-here'
#     static_configs:
#       - targets: ['your-api:3001']
#
# In development, metrics are accessible without auth (with warning)
METRICS_BEARER_TOKEN=
