#!/usr/bin/env node
/**
 * Prisma 7 Post-Generate Script
 *
 * Creates a barrel file (index.ts) in the generated prisma directory
 * to maintain backward compatibility with Prisma 6 import patterns.
 *
 * In Prisma 7, the entry point changed from index.ts to client.ts.
 * This script recreates the index.ts after each `prisma generate`.
 */

import { writeFileSync } from 'fs';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';

const __dirname = dirname(fileURLToPath(import.meta.url));
const generatedDir = join(__dirname, '../src/generated/prisma');
const indexPath = join(generatedDir, 'index.ts');

const barrelContent = `/**
 * Prisma 7 Barrel File - Backward Compatibility Layer
 *
 * AUTO-GENERATED by scripts/prisma-postgenerate.js
 * DO NOT EDIT MANUALLY - This file is recreated after each prisma generate.
 *
 * In Prisma 7, the main entry point changed from index.ts to client.ts.
 * This barrel file re-exports everything from client.ts to maintain
 * backward compatibility with existing imports.
 */

export * from './client';
`;

try {
  writeFileSync(indexPath, barrelContent, 'utf-8');
  console.log('✅ Created Prisma barrel file: src/generated/prisma/index.ts');
} catch (error) {
  console.error('❌ Failed to create Prisma barrel file:', error);
  process.exit(1);
}
